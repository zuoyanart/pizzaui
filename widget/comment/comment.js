define("comment/comment",function(require,exports,module){var $=jQuery=require("jquery"),tools=require("pizzatools"),turnpage=require("turnpage/turnpage");require("layer"),require("pizzaui");var tpg=new turnpage({name:"mcCmt.page",mp:4}),comment=function(){var _this=this,isLogin=!1,obj=$(".comment-wrap"),oInput=$("#comment-textarea"),tpl=[function(locals,filters,escape,rethrow){function rethrow(a,e,t,n){var i=e.split("\n"),r=Math.max(n-3,0),o=Math.min(i.length,n+3),c=i.slice(r,o).map(function(a,e){var t=e+r+1;return(t==n?" >> ":"    ")+t+"| "+a}).join("\n");throw a.path=t,a.message=(t||"ejs")+":"+n+"\n"+c+"\n\n"+a.message,a}escape=escape||function(a){return String(a).replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:'\r\n<% for(var i = 0; i < data.length; i++) { %>\r\n	<ul class="comment-ceil clearfix">\r\n	    <li class="li-1">\r\n	        <a href="<%= data[i].href %>"><img src="<%= data[i].avatar %>" alt=""><span class="span-1"><%= data[i].nickname %></span><span class="span-2"><%= data[i].province %>/<%= data[i].city %></span></a>\r\n	    </li>\r\n	    <li class="icon-link"></li>\r\n	    <li class="li-2"><%= data[i].content %></li>\r\n	    <li class="small"><%= data[i].time %></li>\r\n	    <li class="icon-remove"></li>\r\n	</ul>\r\n<% } %>\r\n\r\n',filename:"widget/comment/comment.ejs"};try{var buf=[];with(locals||{})!function(){buf.push("\n"),__stack.lineno=2;for(var a=0;a<data.length;a++)buf.push('\n	<ul class="comment-ceil clearfix">\n	    <li class="li-1">\n	        <a href="',escape((__stack.lineno=5,data[a].href)),'"><img src="',escape((__stack.lineno=5,data[a].avatar)),'" alt=""><span class="span-1">',escape((__stack.lineno=5,data[a].nickname)),'</span><span class="span-2">',escape((__stack.lineno=5,data[a].province)),"/",escape((__stack.lineno=5,data[a].city)),'</span></a>\n	    </li>\n	    <li class="icon-link"></li>\n	    <li class="li-2">',escape((__stack.lineno=8,data[a].content)),'</li>\n	    <li class="small">',escape((__stack.lineno=9,data[a].time)),'</li>\n	    <li class="icon-remove"></li>\n	</ul>\n'),__stack.lineno=12;buf.push("\n\n")}();return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}][0],uid=tools.getCookie("id"),nid=tools.getCookie("nid"),avatar=tools.getCookie("avatar"),nickname=tools.getCookie("nickname"),targetid=20150902;_this.init=function(){$.ajaxSetup({global:!0,type:"POST",dataType:"JSON",timeout:3e3}),$(document).ajaxStart(function(){layer.close(layer.confirm()),layer.load(2)}).ajaxError(function(){layer.msg("网络错误，请稍后重试！",{time:600})}).ajaxComplete(function(){layer.close(layer.load())}),$(".publish-comment").on("click",function(){_this.create($(this))}),$(".comment-wrap").on("click",".icon-remove",function(){_this.del($(this).parent())}),_this.setAvatar(),oInput.val(""),$("#comment-textarea").wordsTip({min:1,max:128})},_this.setAvatar=function(){var a=tools.getCookie("avatar");"0"!=a&&(isLogin=!0,$("#comment-avatar").attr("src",a))},_this.isMe=function(){},_this.create=function(){var a=tools.xss($.trim($("#comment-textarea").val()).replace(/\s{3,}/g,"").replace(/[\r\n]+/g,"<br>"));if(0==uid)return void layer.msg("您尚未登录，请登录后发表评论！",{time:1e3});var e=oInput.attr("validate");if("false"==e)return void layer.msg("评论不可为空且字数在128字以内！",{time:1e3});var t={data:[{href:"http://www.baidu.com/",avatar:"style.jpg",nickname:"TianMing",province:"河南",city:"郑州",content:a,time:"2015-09-01   14:28"}]};$.ajax({url:"/webpart/upcomment",data:{uid:uid,nid:nid,content:a,avatar:avatar,nickname:nickname,targetid:targetid,"&_csrf=":$("#csrf").val()}}).done(function(a){"true"===a.state&&obj.prepend(tpl(t)),oInput.val("")})},_this.page=function(a){var e={url:"/webpart/getcomment",data:{cp:a,targetid:targetid,"&_csrf":$("#csrf").val()}};a||(a=1,e.global=!1),$.ajax(e).done(function(e){0!=e.sum&&(obj.siblings(".turnpage").remove(),obj.html(tpl(e)).after(tpg.hud(a,e.sum)))})},_this.del=function(a){layer.confirm("确定删除这条评论吗？",function(){$.post({url:"/webpart/delcomment",data:{uid:uid,commentid:123456,"&_csrf":$("#csrf").val()}}).done(function(e){"true"===e.state&&a.slideUp(500,function(){a.remove()})})})},_this.addone=function(){console.log("评论增加一条")}};module.exports=comment});